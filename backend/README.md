# FamilyCoins Backend

–ë—ç–∫–µ–Ω–¥ –¥–ª—è —Å–µ–º–µ–π–Ω–æ–≥–æ –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è FamilyCoins.

## –û–ø–∏—Å–∞–Ω–∏–µ

FamilyCoins - —ç—Ç–æ API –¥–ª—è –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–º–æ–≥–∞–µ—Ç —Ä–æ–¥–∏—Ç–µ–ª—è–º –º–æ—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –¥–µ—Ç–µ–π –≤—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–¥–∞–Ω–∏—è —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –∫–æ–∏–Ω–æ–≤.

## –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

- üë®‚Äçüë©‚Äçüëß‚Äçüë¶ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–º—å–µ–π**: —Å–æ–∑–¥–∞–Ω–∏–µ —Å–µ–º—å–∏, –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- üìã **–°–∏—Å—Ç–µ–º–∞ –∑–∞–¥–∞–Ω–∏–π**: —Å–æ–∑–¥–∞–Ω–∏–µ, –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π
- ü™ô **–ö–æ–∏–Ω —Å–∏—Å—Ç–µ–º–∞**: –∑–∞—Ä–∞–±–æ—Ç–æ–∫ –∏ —Ç—Ä–∞—Ç–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –∫–æ–∏–Ω–æ–≤
- üõçÔ∏è **–°–µ–º–µ–π–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω**: –ø–æ–∫—É–ø–∫–∞ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π –∏ –Ω–∞–≥—Ä–∞–¥
- üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**: –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **Backend**: FastAPI (Python 3.11+)
- **Database**: PostgreSQL + Redis
- **ORM**: SQLAlchemy (async)
- **Authentication**: JWT —Ç–æ–∫–µ–Ω—ã
- **Deployment**: Docker + Docker Compose

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.11+
- Docker –∏ Docker Compose
- PostgreSQL (–µ—Å–ª–∏ –∑–∞–ø—É—Å–∫ –±–µ–∑ Docker)
- Redis (–µ—Å–ª–∏ –∑–∞–ø—É—Å–∫ –±–µ–∑ Docker)

### –ó–∞–ø—É—Å–∫ —Å Docker

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
cd backend

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose up -d

# API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É http://localhost:8000
```

### –ó–∞–ø—É—Å–∫ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å .env —Ñ–∞–π–ª

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
uvicorn app.main:app --reload

# API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É http://localhost:8000
```

## API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å–∞–º:

- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc

## –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- `POST /v1/auth/family/create` - –°–æ–∑–¥–∞—Ç—å —Å–µ–º—å—é
- `POST /v1/auth/family/join` - –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ —Å–µ–º—å–µ
- `GET /v1/auth/family/members` - –ü–æ–ª—É—á–∏—Ç—å —á–ª–µ–Ω–æ–≤ —Å–µ–º—å–∏

### –ó–∞–¥–∞–Ω–∏—è
- `GET /v1/tasks/templates` - –ü–æ–ª—É—á–∏—Ç—å —à–∞–±–ª–æ–Ω—ã –∑–∞–¥–∞–Ω–∏–π
- `POST /v1/tasks` - –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ (—Ä–æ–¥–∏—Ç–µ–ª–∏)
- `GET /v1/tasks/my` - –ü–æ–ª—É—á–∏—Ç—å –º–æ–∏ –∑–∞–¥–∞–Ω–∏—è
- `PUT /v1/tasks/assignments/{id}/complete` - –û—Ç–º–µ—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (–¥–µ—Ç–∏)
- `PUT /v1/tasks/assignments/{id}/approve` - –û–¥–æ–±—Ä–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (—Ä–æ–¥–∏—Ç–µ–ª–∏)

### –ú–∞–≥–∞–∑–∏–Ω
- `GET /v1/store/items` - –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä—ã
- `POST /v1/store/items` - –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä (—Ä–æ–¥–∏—Ç–µ–ª–∏)
- `POST /v1/store/purchase` - –ö—É–ø–∏—Ç—å —Ç–æ–≤–∞—Ä (–¥–µ—Ç–∏)

### –ö–æ–∏–Ω—ã
- `GET /v1/coins/balance` - –ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å
- `GET /v1/coins/transactions` - –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- `POST /v1/coins/adjust` - –†—É—á–Ω–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ (—Ä–æ–¥–∏—Ç–µ–ª–∏)

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- `GET /v1/stats/family` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ–º—å–∏ (—Ä–æ–¥–∏—Ç–µ–ª–∏)
- `GET /v1/stats/child` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ–±–µ–Ω–∫–∞

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
DATABASE_URL=postgresql+asyncpg://user:password@localhost:5432/familycoins
REDIS_URL=redis://localhost:6379
JWT_SECRET_KEY=your_super_secret_jwt_key_here
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=1440
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
backend/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ api/              # API endpoints
‚îÇ   ‚îú‚îÄ‚îÄ models/           # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ schemas/          # Pydantic —Å—Ö–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ services/         # –ë–∏–∑–Ω–µ—Å –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ utils/            # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ database.py       # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ main.py           # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ tests/                # –¢–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ docker-compose.yml    # Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ Dockerfile           # Docker –æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ requirements.txt     # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ README.md           # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:
- `families` - –°–µ–º—å–∏
- `users` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (—Ä–æ–¥–∏—Ç–µ–ª–∏ –∏ –¥–µ—Ç–∏)
- `task_templates` - –®–∞–±–ª–æ–Ω—ã –∑–∞–¥–∞–Ω–∏–π
- `tasks` - –ó–∞–¥–∞–Ω–∏—è
- `task_assignments` - –ù–∞–∑–Ω–∞—á–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π
- `store_items` - –¢–æ–≤–∞—Ä—ã –≤ –º–∞–≥–∞–∑–∏–Ω–µ
- `purchases` - –ü–æ–∫—É–ø–∫–∏
- `coin_balances` - –ë–∞–ª–∞–Ω—Å—ã –∫–æ–∏–Ω–æ–≤
- `coin_transactions` - –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∫–æ–∏–Ω–æ–≤

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ–º—å–∏

```bash
curl -X POST "http://localhost:8000/v1/auth/family/create" \
     -H "Content-Type: application/json" \
     -d '{
       "family_name": "–°–µ–º—å—è –ò–≤–∞–Ω–æ–≤—ã—Ö",
       "parent_name": "–ê–Ω–Ω–∞ –ò–≤–∞–Ω–æ–≤–∞"
     }'
```

### –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ —Å–µ–º—å–µ

```bash
curl -X POST "http://localhost:8000/v1/auth/family/join" \
     -H "Content-Type: application/json" \
     -d '{
       "passcode": "123456",
       "user_name": "–ü–µ—Ç—è –ò–≤–∞–Ω–æ–≤",
       "role": "child"
     }'
```

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
pytest

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest --cov=app
```

### –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
alembic revision --autogenerate -m "Description"

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head
```

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License



–£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä:
–õ–æ–≥–∏–Ω: admin
–ü–∞—Ä–æ–ª—å: 123456
–†–µ–±–µ–Ω–æ–∫:
–õ–æ–≥–∏–Ω: daughter
–ü–∞—Ä–æ–ª—å: child123